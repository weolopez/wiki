<div ng-init="page.storage.loadPages()">

    <div class="item item-input-inset" style="border: none;">

        <div class="storyEditAttributeHeader item item-input-inset" 
             >
            <button class="btn" 
                    ng-if="page.page.edit"
                    ng-click= "page.page.save();
                        page.page.edit = false;
                        page.page.storyIndex = -1;"
                    style="background-color: red;color:black;"
                    ng-class="{'red':page.page.current.dirty}"
                    >Save</button>       
            <button class="btn" 
                    ng-if="!page.page.edit"
                    ng-click= "page.page.edit = true;
                        page.page.setSource(key);"
                    style="background-color: red;color:black;"
                    ng-class="{'red':page.page.current.dirty}"
                    >Edit</button>                 
            <button class="btn"
                    ng-if="page.page.current.dirty"
                    ng-click= "page.storage.preferedSources = key;
                        page.page.setSource(key);
                        page.page.save();"
                    ng-repeat="(source, key) in page.page.getKeys(page.storage.persistance.sources)"
                    style="background-color: {{page.storage.persistance.sources[key].color}}"
                    ng-class="{'active':page.storage.preferedSources === key}"
                    >{{page.storage.persistance.sources[key].name}}</button>                      
        </div>

        <label class="item-input-wrapper">
            <i class="icon ion-search placeholder-icon"></i>
            <input type="search" placeholder="Search">
            <input type="text" 
                   action
                   on-return="page.location.path('/app/page/'+searchPageName);
                   searchPageName='';"
                   ng-model="searchPageName" 
                   style="width:100%;">
        </label>
        <i class="icon-left ion-more fa-rotate-90"
           ng-click="setSource = !setSource;"
           style="margin-left: 10px;"
           ></i>
    </div>
    <p id="leadtext" ng-if="setSource">search sites</p>
    <div class="storyEditAttributeHeader item item-input-inset" 
         ng-if="setSource"
         >

        <button class="btn" 
                ng-click= "page.storage.persistance.sources[key].loadPages = !page.storage.persistance.sources[key].loadPages;
                    page.storage.loadPagesBySource(page.storage.persistance.sources[key])"
                ng-repeat="(source, key) in page.page.getKeys(page.storage.persistance.sources)"
                style="background-color: {{page.storage.persistance.sources[key].color}}"
                ng-class="{'active':page.storage.persistance.sources[key].loadPages}"
                >{{page.storage.persistance.sources[key].name}}</button>                      
    </div>
    <div>
        <div class="list card" ng-if="searchPageName.length > 2">
            <a class="item item-icon-left"
               href="#/app/page/{{value.pageName}}"
               ng-repeat="(name, value) in page.storage.pages | filter:searchPageName track by $index"
               ng-style=""
               >
                <i class="icon ion-document"
                   style="background-color: {{value.source.color}}"></i>
                <h2>{{value.pageName}}</h2>
            </a>
        </div>
    </div>
</div>